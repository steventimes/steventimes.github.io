---
const { items } = Astro.props;
// items: { label, href }[]
---

<div id="cmdk-root" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/50"></div>

  <div class="absolute left-1/2 top-24 w-[min(760px,92vw)] -translate-x-1/2 glass shadow-soft rounded-2xl overflow-hidden border border-white/10">
    <div class="p-4 border-b border-white/10 flex items-center gap-3">
      <span class="text-xs px-2 py-1 rounded-full bg-black/5 dark:bg-white/10 border border-black/10 dark:border-white/10 text-heading">Ctrl F</span>
      <input
        id="cmdk-input"
        class="w-full bg-transparent outline-none text-base text-heading placeholder:text-muted"
        placeholder="Type to searchâ€¦ (e.g., projects, github, contact)"
      />
      <button id="cmdk-close" class="text-sm opacity-80 hover:opacity-100 text-heading">Esc</button>
    </div>

    <div id="cmdk-list" class="max-h-[55vh] overflow-auto p-2"></div>
  </div>

  <script define:vars={{ items }}>
    (() => {
      const root = document.getElementById("cmdk-root");
      const input = document.getElementById("cmdk-input");
      const list = document.getElementById("cmdk-list");
      const close = document.getElementById("cmdk-close");

      const render = (q = "") => {
        const query = q.trim().toLowerCase();
        const filtered = (items || []).filter((i) =>
          i.label.toLowerCase().includes(query)
        );

        list.innerHTML =
          filtered
            .map(
              (i) => `
          <a class="block px-3 py-2 rounded-xl hover:bg-black/5 dark:hover:bg-white/10 transition text-heading"
             href="${i.href}">
            <div class="font-medium">${i.label}</div>
            <div class="text-xs opacity-70">${i.href}</div>
          </a>
        `
            )
            .join("") || `<div class="px-3 py-8 text-sm opacity-70 text-body">No results.</div>`;
      };

      const open = () => {
        root.classList.remove("hidden");
        render("");
        setTimeout(() => input.focus(), 0);
      };

      const hide = () => root.classList.add("hidden");

      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "f") {
          e.preventDefault();
          root.classList.contains("hidden") ? open() : hide();
        }
        if (e.key === "Escape" && !root.classList.contains("hidden")) hide();
      });

      root.addEventListener("click", (e) => {
        if (e.target === root || e.target === root.firstElementChild) hide();
      });

      close.addEventListener("click", hide);
      input.addEventListener("input", () => render(input.value));
    })();
  </script>
</div>
